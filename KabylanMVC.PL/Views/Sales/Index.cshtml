@{
    ViewData["Title"] = "View";

}

<div class="row gx-3">
    <div class="col col-sm-6">
        <div class="table-responsive card-body SaleCardsScrolPanel">
            <table id="SalesTable" class="table table-hover bg-white border">
                <thead>
                    <tr class="table-borderless">
                        <th>
                            Имя
                        </th>
                        <th>
                            Фамилия
                        </th>
                        <th>
                            Отчество
                        </th>

                        <th></th>
                    </tr>
                </thead>
            </table>

        </div>
    </div>

    <div class="col col-sm-6">
            <div class="my-3 p-3 text-center border border-3 overflow-auto CastomersPanel">

                <form method="post">
                    <div class="row p-3">

                        <!--Upartment data-->
                        <div class="col-sm-4">
                            <label for="Square" class="form-label mb-0 mt-2">площадь</label>
                            <input type="number" class="form-control text-center" id="Square" readonly>
                        </div>
                        <div class="col-sm-4">
                            <label for="RoomCount" class="form-label mb-0 mt-2">к-во комнат</label>
                            <input type="number" class="form-control text-center" id="RoomCount" readonly>
                        </div>
                        <div class="col-sm-4">
                            <label for="Price" class="form-label mb-0 mt-2">ценна $</label>
                            <input type="number" class="form-control text-center" id="Price" readonly>
                        </div>

                        <!--Payment data-->
                        <div class="col-sm-4">
                            <label for="PaydMonths" class="form-label mb-0 mt-2">К-во месяцев для рассрочки</label>
                            <input type="number" class="form-control text-center" id="PaydMonths" readonly>
                        </div>
                        
                        <div class="col-sm-4">
                            <label for="payd" class="form-label">оплата/месяц</label>
                            <input type="text" class="form-control text-center" id="payd" readonly>
                        </div>
                        <div class="col-sm-4">
                            <label for="payd" class="form-label">оплачено</label>
                            <input type="text" class="form-control text-center" id="payd" readonly>
                         </div>
                         <div class="col-sm-4">
                             <label for="havePayd" class="form-label">ост-сь оплатить</label>
                             <input type="text" class="form-control text-center" id="havePayd" readonly>
                         </div>

                        <div class="col-sm-8 my-4 py-2 my-4">
                            <a href="/Sales/Create" class="btn border-primary w-100">Добавить продажу</a>
                        </div>          
                    </div>
                </form>
            </div>

            <div class="my-3 p-3 border  border-3 d-none d-sm-block p-0" id="paymants">
                <div class="table-responsive  PaymentPanel card-body m-0 p-0">
                    <table id="PaymantsTable" class="table right-all table-hover bg-white border p-0 m-0 w-100">
                        <thead>
                            <tr class="table-borderless">
                                <th>
                                    Дата оплаты
                                </th>
                                <th>
                                    Сумма
                                </th>

                                <th></th>
                            </tr>
                        </thead>
                    </table>


                </div>
                <div class="row">
                    <div class="col-3">
                     <input type="text" class="form-control text-center">
                    </div>
                    <div class="col-3">
                     <input type="number" class="form-control text-center">
                    </div>
                    <div class="col-4">
                        <a  class="btn border-primary w-100">Добавить оплату</a>
                    </div>
                </div>
            </div>
        </div>
</div>





@section Scripts {
 <script>

    function formatDate(date) {
        var d = new Date(date),
        month = '' + (d.getMonth() + 1),
        day = '' + d.getDate(),
        year = d.getFullYear();
    
        if (month.length < 2)
            month = '0' + month;
        if (day.length < 2)
            day = '0' + day;
    
        return [day, month, year].join('.');
    };

    $(document).ready(function() {
        let table = $("#SalesTable").DataTable({
            autoWidth: true,
            processing: true,
            serverSide: true,
            fixedHeader: true,
            ordering: false,
            colReorder: true,
            searching: false,
            lengthChange: false,
            pageLength: 50,
            scrollY:        "86vh",
            
            ajax: {
                url: "/Sales/LoadTable",
                type: "POST",
                contentType: "application/json",
                dataType: "json",
                data: function(data) {
                    return JSON.stringify(data);
                }
            },
            columns: [
                { data: "firstName" },
                { data: "middleName" },
                { data: "lastName" },
                {
                       data: "id",
                       render(data, type, row, meta) {
                            @{<text>
                                                                           return `
                                                                                   <a id="editCustomer" href="/Sales/EditCustomer?id=` + data + `" class="badge mr-2 p-2 me-2" style="font-size:90%%"><i class="fa fa-edit"></i></a>
                                                                                   <a class="badge mr-2 p-2 ms-2" href="/Sales/DeleteCustomer?id=` + data + `" style="font-size:90%"><i id="deleteCustomer" class="fa fa-trash"></i></a>
                                                                               `
                                                                       </text>}
                       }
                 }
            ]
        });


        $('#SalesTable tbody').on('click', 'tr', function () {
              $(this).toggleClass("selected");
            var customer = table.row( this ).data();
            $.get('Sales/GetSale', { id: customer.saleId }, function(res) {
                $('#Square').val(res['square']);
                $('#RoomCount').val(res['roomCount']);
                $('#Price').val(res['price']);
                $('#PaydMonths').val(res['payingMonths']);


                $("#PaymantsTable").DataTable({
                    paginate: false,
                    filter: false,
                    info: false,
                    autoWidth: true,
                    processing: true,
                    fixedHeader: true,
                    ordering: false,
                    searching: false,
                    lengthChange: false,
                    data: res['payments'],
                    columns: [
                        { data: "date" },
                        { data: "moneyCount" }
                    ]
                });
            });
        });
    });
 </script>
}